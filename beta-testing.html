<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mokka KDE</title>
  <link rel="icon" type="image/x-icon" href="https://img.icons8.com/fluency/96/linux.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- NOTIFICATIONS -->
  <div class="notification-area" id="notif-area"></div>

  <!-- BSOD / CRASH SCREEN -->
  <div id="bsod-layer" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#0078d7; color:white; padding:100px; z-index:1000000; font-family:'Segoe UI'; cursor:none;" onclick="location.reload()">
      <h1 style="font-size:100px; margin:0;">:(</h1><h2>Your PC ran into a problem and needs to restart.</h2>
  </div>

  <!-- START MENU (Now positioned Top-Left or Center depending on CSS) -->
  <div id="start-menu">
      <input type="text" class="sm-search" placeholder="Search apps..." onkeyup="filterStartApps(this.value)">
      <div class="sm-grid" id="start-grid"></div>
      <div class="sm-footer">
          <div class="sm-user">
              <img src="" id="sm-avatar" class="sm-avatar">
              <strong id="sm-username">User</strong>
          </div>
          <div class="sm-actions">
              <i class="fas fa-lock sm-power" title="Lock" onclick="location.reload()"></i>
              <i class="fas fa-power-off sm-power" title="Shut Down" onclick="document.body.innerHTML='';document.body.style.background='black';"></i>
          </div>
      </div>
  </div>

  <!-- DEV TOOLS -->
  <div id="dev-panel">
    <h3>DEV_TOOLS v0.4</h3>
    <div class="dev-section"><button onclick="localStorage.clear();location.reload()" style="color:red;background:#300;border:1px solid red;width:100%;">FACTORY RESET</button></div>
    <div class="dev-section"><button onclick="devForceUnlock()">FORCE UNLOCK</button></div>
    <div class="dev-section">MEM: <span id="dev-mem">0</span> MB | UP: <span id="dev-up">0</span>s</div>
    <div class="dev-section" id="dev-log" style="height:200px;overflow-y:auto;font-size:10px;"></div>
    <button onclick="document.getElementById('dev-panel').classList.remove('active')">CLOSE</button>
  </div>

  <!-- AUTH SCREENS -->
  <div id="auth-layer">
    <div id="setup-screen" class="auth-container">
      <h2>Setup Mokka OS</h2>
      <input type="text" id="su-user" class="auth-input" placeholder="Username">
      <input type="password" id="su-pass" class="auth-input" placeholder="Password">
      <input type="password" id="su-conf" class="auth-input" placeholder="Confirm">
      <input type="text" id="su-pfp" class="auth-input" placeholder="Avatar URL">
      <button class="auth-btn" onclick="doSetup()">Create Account</button>
    </div>
    <div id="lock-screen" class="auth-container">
        <img src="" id="ls-avatar" style="width:80px;height:80px;border-radius:50%;margin-bottom:10px;object-fit:cover;">
        <h2 id="ls-user">User</h2>
        <input type="password" id="ls-pass" class="auth-input" placeholder="Password">
        <button class="auth-btn" onclick="doLogin()">Unlock</button>
    </div>
  </div>

  <!-- MAIN INTERFACE -->
  <div id="os-interface">
      
      <!-- TOP BAR (Status & Time) -->
      <div id="top-bar">
          <div class="tb-left" onclick="toggleStartMenu()">
              <i class="fab fa-linux"></i> <span>Mokka KDE</span>
          </div>
          <div class="tb-center">
              <span id="clock-date">...</span> | <span id="clock">00:00</span>
          </div>
          <div class="tb-right">
              <i class="fas fa-volume-up"></i>
              <i class="fas fa-wifi"></i>
              <i class="fas fa-battery-three-quarters"></i>
          </div>
      </div>

      <!-- DESKTOP AREA -->
      <div class="desktop" id="desktop-icons"></div>

      <!-- SENTINEL WIDGET (Keeping it, but ensures it doesn't overlap) -->
      <div id="sentinel">
        <div class="header">
            <div class="time" id="clock-time" style="display:none;">00:00</div> <!-- Hidden as it's in top bar now -->
        </div>
        <div class="stage">
            <canvas id="viz-canvas"></canvas>
            <div class="controls-layer">
                <div class="track-info">
                    <div class="t-title" id="track-title">System Ready</div>
                    <div class="t-artist" id="track-artist">2025 Mix</div>
                </div>
                <div class="btn-row">
                    <i class="fas fa-step-backward icon-btn" onclick="changeTrack(-1)"></i>
                    <div class="play-circle" onclick="togglePlay()">
                        <i class="fas fa-play" id="play-icon"></i>
                    </div>
                    <i class="fas fa-step-forward icon-btn" onclick="changeTrack(1)"></i>
                </div>
                <div class="playlist-box" id="playlist-list"></div>
                <div class="s-actions" style="margin-top:15px;">
                    <div class="act-btn" title="Fullscreen" onclick="toggleFullscreen()"><i class="fas fa-expand"></i></div>
                    <div class="act-btn" title="Performance Mode" onclick="togglePerformance()"><i class="fas fa-bolt"></i></div>
                    <div class="act-btn" title="Show Desktop" onclick="minimizeAll()"><i class="fas fa-desktop"></i></div>
                    <div class="act-btn" title="Do Not Disturb" onclick="toggleDND(this)"><i class="fas fa-moon"></i></div>
                </div>
            </div>
        </div>
      </div>

      <!-- BOTTOM DOCK (Apps Only) -->
      <div class="dock-container">
        <div class="dock" id="taskbar-list">
            <!-- Apps will be injected here by JS -->
        </div>
      </div>

  </div>
  
  <script src="main.js"></script>
  <audio id="audio-player" crossorigin="anonymous"></audio>
</body>
</html>
