<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yasu OS</title>
  <link rel="icon" type="image/x-icon" href="Win7Xcel.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    /* GLOBAL RESET */
    * { box-sizing: border-box; }

    /* =========================================
       CORE STYLES
       ========================================= */
    body {
      margin: 0;
      padding: 0;
      background: url('https://platform.theverge.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/22661975/img24.jpg?quality=90&strip=all') no-repeat center center fixed;
      background-size: cover;
      font-family: "Segoe UI", sans-serif;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    /* =========================================
       DEV PANEL STYLES (Expanded)
       ========================================= */
    #dev-panel {
        position: fixed; top: 0; right: -400px; width: 350px; height: 100%;
        background: rgba(10, 10, 10, 0.95); border-left: 2px solid #00ff00;
        z-index: 999999; color: #00ff00; font-family: 'Courier New', Courier, monospace;
        padding: 20px; transition: right 0.3s ease; overflow-y: auto;
        display: flex; flex-direction: column; gap: 15px;
        box-shadow: -10px 0 30px rgba(0,0,0,0.8);
    }
    #dev-panel.active { right: 0; }
    
    .dev-header { font-weight: bold; border-bottom: 1px solid #00ff00; padding-bottom: 10px; display: flex; justify-content: space-between; }
    .dev-close { cursor: pointer; } .dev-close:hover { color: white; }
    
    .dev-section { border: 1px solid rgba(0, 255, 0, 0.3); padding: 10px; border-radius: 4px; background: rgba(0, 50, 0, 0.2); }
    .dev-section h3 { margin: 0 0 10px 0; font-size: 12px; text-transform: uppercase; color: #aaa; border-bottom: 1px solid #333; padding-bottom: 5px; }
    
    .dev-textarea { width: 100%; height: 80px; background: #000; color: #00ff00; border: 1px solid #333; font-size: 10px; font-family: monospace; margin-bottom: 5px; }
    .dev-input { width: 100%; background: #000; color: #00ff00; border: 1px solid #333; padding: 5px; font-family: monospace; margin-bottom: 5px; }
    
    .dev-btn { width: 100%; padding: 6px; margin-top: 4px; background: #003300; color: #00ff00; border: 1px solid #00ff00; cursor: pointer; font-family: monospace; text-align: left; font-size: 11px; }
    .dev-btn:hover { background: #00ff00; color: black; }
    .dev-btn.danger { border-color: red; color: red; background: #330000; }
    .dev-btn.danger:hover { background: red; color: white; }
    
    .process-item { display: flex; justify-content: space-between; font-size: 11px; border-bottom: 1px solid #333; padding: 2px 0; }
    .kill-btn { color: red; cursor: pointer; font-weight: bold; }

    .dev-log { height: 100px; overflow-y: auto; background: black; border: 1px solid #333; padding: 5px; font-size: 10px; color: #aaa; }

    /* =========================================
       BONUS SCREENS (BSOD & MATRIX)
       ========================================= */
    #bsod-layer {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #0078d7; color: white; z-index: 1000000;
        display: none; flex-direction: column; padding: 100px;
        font-family: 'Segoe UI', sans-serif; cursor: none;
    }
    #bsod-layer h1 { font-size: 100px; margin: 0 0 20px 0; }
    #bsod-layer h2 { font-size: 24px; font-weight: normal; }
    
    #matrix-layer {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        z-index: 999998; display: none; pointer-events: none;
        background: black;
    }

    /* =========================================
       AUTH & LOCK SCREENS
       ========================================= */
    #auth-layer {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
      z-index: 99999; display: flex; justify-content: center; align-items: center;
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .auth-container {
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); padding: 40px;
      border-radius: 16px; width: 350px; display: flex; flex-direction: column; align-items: center; 
      text-align: center; color: white; box-shadow: 0 20px 50px rgba(0,0,0,0.5); display: none; 
    }
    .auth-avatar { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 20px; object-fit: cover; border: 3px solid rgba(255,255,255,0.3); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .input-wrapper { position: relative; width: 100%; margin: 8px 0; }
    .auth-input {
      width: 100%; padding: 12px 35px 12px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.3); color: white; outline: none; text-align: center; transition: 0.3s; font-size: 1rem;
    }
    .auth-input:focus { border-color: #e0aaff; background: rgba(0,0,0,0.5); }
    .auth-input::placeholder { color: rgba(255,255,255,0.5); }
    .toggle-password { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: rgba(255,255,255,0.6); font-size: 0.9rem; }
    .toggle-password:hover { color: #fff; }
    .auth-btn { margin-top: 15px; padding: 10px 25px; border-radius: 20px; background: #e0aaff; color: #240046; font-weight: bold; border: none; cursor: pointer; transition: transform 0.2s; width: 100%; }
    .auth-btn:hover { transform: scale(1.02); background: #fff; }
    @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
    .shake { animation: shake 0.3s ease-in-out; border-color: red !important; }

    /* =========================================
       YASU OS UI
       ========================================= */
    #os-interface { opacity: 0; transition: opacity 1s ease; pointer-events: none; }
    @keyframes fadeInUp { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; display: none; } }

    /* Taskbar */
    .taskbar {
      position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); width: 98%; height: 52px;
      background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; display: flex; justify-content: space-between; align-items: center;
      padding: 0 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); z-index: 999;
    }
    .taskbar-start { display: flex; align-items: center; width: 200px; }
    .start-btn { width: 36px; height: 36px; cursor: pointer; transition: transform 0.2s; filter: drop-shadow(0 0 5px rgba(0, 120, 215, 0.5)); }
    .start-btn:hover { transform: scale(1.15); }
    .taskbar-apps { display: flex; align-items: center; gap: 8px; }
    .taskbar-apps img { width: 32px; height: 32px; cursor: pointer; transition: all 0.2s; padding: 4px; border-radius: 6px; position: relative; }
    .taskbar-apps img:hover { transform: translateY(-6px) scale(1.1); background: rgba(255, 255, 255, 0.1); }
    .taskbar-apps img::after { content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background: white; border-radius: 50%; opacity: 0.8; }
    .taskbar-tray { display: flex; align-items: center; justify-content: flex-end; gap: 15px; width: 200px; color: white; }
    .tray-icons { display: flex; gap: 12px; font-size: 0.9rem; opacity: 0.8; }
    .tray-clock { text-align: right; font-size: 0.75rem; padding-left: 10px; border-left: 1px solid rgba(255,255,255,0.2); }
    #taskbar-time { font-weight: bold; font-size: 0.85rem; }

    /* Desktop */
    .desktop { position: absolute; top: 20px; left: 20px; display: flex; flex-direction: column; flex-wrap: wrap; gap: 10px; height: calc(100% - 80px); z-index: 1; }
    .icon { text-align: center; cursor: pointer; color: white; width: 80px; transition: transform 0.2s; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
    .icon:hover { transform: scale(1.05); background: rgba(255,255,255,0.1); border-radius: 5px; }
    .icon img { width: 48px; height: 48px; margin-bottom: 5px; }

    /* Windows */
    .window {
      position: absolute; width: 800px; height: 600px;
      background: rgba(22, 22, 30, 0.85); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
      border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
      display: none; animation: fadeInUp 0.3s cubic-bezier(0.19, 1, 0.22, 1) forwards;
      top: 100px; left: 100px; overflow: hidden; border-radius: 10px; z-index: 100; 
    }
    .window.fadeOut { animation: fadeOut 0.2s ease forwards; }
    .window .title-bar { background: rgba(255, 255, 255, 0.05); color: #eee; padding: 8px 15px; cursor: move; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .window .title-bar button { background: #ff5f56; border: none; width: 14px; height: 14px; border-radius: 50%; color: transparent; }
    .window .title-bar button:hover { color: rgba(0,0,0,0.5); }
    .window .title-bar .controls { display: flex; gap: 8px; }
    .fake-min { width: 14px; height: 14px; background: #ffbd2e; border-radius: 50%; }
    .fake-max { width: 14px; height: 14px; background: #27c93f; border-radius: 50%; }
    .window .content { height: calc(100% - 40px); background: rgba(255,255,255,0.95); }
    .window iframe, .window .content > div { width: 100%; height: 100%; border: none; }
    .resize-handle { width: 15px; height: 15px; position: absolute; bottom: 0; right: 0; cursor: nwse-resize; }

    /* Browser UI */
    .browser-window .content { display: flex; flex-direction: column; background: #fff; }
    .browser-bar { display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: #f1f3f4; border-bottom: 1px solid #e0e0e0; }
    .browser-btn { background: transparent; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; color: #5f6368; transition: 0.2s; }
    .browser-btn:hover { background: rgba(0,0,0,0.1); color: #202124; }
    .browser-input { flex-grow: 1; padding: 8px 15px; border-radius: 20px; border: none; background: #fff; color: #202124; font-size: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); outline: none; transition: 0.2s; }
    .browser-input:focus { box-shadow: 0 1px 5px rgba(32,33,36,0.2); }
    .browser-frame { flex-grow: 1; border: none; width: 100%; }

    /* Terminal UI */
    .terminal-window { background-color: #0c0c0c !important; color: #00ff00; font-family: 'Courier New', Courier, monospace; padding: 10px; box-sizing: border-box; overflow: hidden; display: flex; flex-direction: column; }
    .terminal-output { flex-grow: 1; overflow-y: auto; white-space: pre-wrap; margin-bottom: 10px; }
    .terminal-input-line { display: flex; align-items: center; }
    .terminal-prompt { margin-right: 10px; color: #00ff00; font-weight: bold; }
    .terminal-input { background: transparent; border: none; color: #fff; font-family: inherit; flex-grow: 1; outline: none; font-size: 16px; }
    .terminal-output::-webkit-scrollbar { width: 8px; }
    .terminal-output::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

    /* Sentinel */
    :root { --glass-surface: rgba(255, 255, 255, 0.05); --glass-border: rgba(255, 255, 255, 0.1); --glass-highlight: rgba(224, 170, 255, 0.2); --text-main: #e0aaff; --text-sub: rgba(224, 170, 255, 0.6); --accent: #9d4edd; --physics: cubic-bezier(0.25, 1, 0.5, 1); --w-collapsed: 60px; --w-expanded: 320px; }
    #sentinel { position: fixed; top: 50%; right: 24px; transform: translateY(-50%); width: var(--w-collapsed); min-height: 220px; max-height: 80vh; background: var(--glass-surface); backdrop-filter: blur(40px) saturate(180%); -webkit-backdrop-filter: blur(40px) saturate(180%); box-shadow: inset 0 0 0 1px var(--glass-border), 0 20px 50px rgba(0,0,0,0.8); border-radius: 30px; transition: width 0.6s var(--physics), background 0.6s ease, border-radius 0.6s var(--physics); display: flex; flex-direction: column; align-items: center; padding: 30px 0; z-index: 900; overflow: hidden; color: var(--text-main); }
    #sentinel:hover { width: var(--w-expanded); border-radius: 24px; background: rgba(15, 5, 25, 0.7); }
    .header { display: flex; flex-direction: column; align-items: center; width: 100%; flex-shrink: 0; z-index: 2; }
    .time { font-weight: 500; font-size: 0.9rem; opacity: 0.9; color: #fff; }
    .date { font-size: 0.75rem; color: var(--text-sub); height: 0; opacity: 0; transition: 0.4s var(--physics); }
    #sentinel:hover .date { height: auto; opacity: 1; margin-top: 4px; }
    .stage { flex-grow: 1; width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; margin-top: 20px; }
    #viz-canvas { position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; opacity: 0.3; transition: opacity 0.5s; }
    #sentinel:hover #viz-canvas { opacity: 0.7; }
    .controls-layer { width: 100%; padding: 0 20px; display: flex; flex-direction: column; align-items: center; opacity: 0; transform: scale(0.95); transition: 0.4s 0.05s var(--physics); pointer-events: none; display: none; }
    #sentinel:hover .controls-layer { opacity: 1; transform: scale(1); pointer-events: all; display: flex; }
    .track-info { text-align: center; margin-bottom: 20px; width: 100%; }
    .t-title { font-weight: 700; font-size: 1.1rem; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .t-artist { font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; }
    .btn-row { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
    .icon-btn { color: var(--text-sub); font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
    .icon-btn:hover { color: #fff; transform: scale(1.1); }
    .play-circle { width: 52px; height: 52px; background: #fff; color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; cursor: pointer; transition: 0.3s var(--physics); }
    .play-circle:hover { transform: scale(1.1); }
    .playlist-box { width: 100%; max-height: 200px; overflow-y: auto; border-top: 1px solid var(--glass-border); padding-top: 10px; display: flex; flex-direction: column; gap: 6px; }
    .playlist-box::-webkit-scrollbar { width: 3px; }
    .playlist-box::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
    .pl-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; color: var(--text-sub); transition: 0.2s; border: 1px solid transparent; }
    .pl-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .pl-item.active { background: var(--glass-highlight); color: #fff; font-weight: 700; border: 1px solid rgba(224, 170, 255, 0.3); }
    .pl-title { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .pl-anim { display: flex; gap: 2px; align-items: flex-end; height: 10px; opacity: 0; }
    .pl-item.active .pl-anim { opacity: 1; }
    .bar { width: 2px; background: #fff; animation: bounce 0.4s infinite alternate; }
    .bar:nth-child(1) { animation-duration: 0.5s; } .bar:nth-child(2) { animation-duration: 0.4s; } .bar:nth-child(3) { animation-duration: 0.6s; }
    @keyframes bounce { 0% { height: 2px; } 100% { height: 12px; } }

    /* Context Menu */
    #custom-context-menu { position: absolute; display: none; z-index: 10000; background: rgba(40, 40, 45, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 5px; border-radius: 8px; min-width: 150px; }
    #custom-context-menu div { cursor: pointer; padding: 8px 12px; border-radius: 4px; }
    #custom-context-menu div:hover { background: rgba(255,255,255,0.1); }
  </style>
</head>
<body>

  <div id="bsod-layer" onclick="location.reload()">
      <h1>:(</h1>
      <h2>Your PC ran into a problem and needs to restart. We're just collecting some error info, and then we'll restart for you.</h2>
      <br><br>
      <p>0% complete</p>
      <br>
      <p style="font-size:14px;">Stop code: YASU_KERNEL_PANIC</p>
  </div>

  <canvas id="matrix-layer"></canvas>

  <div id="dev-panel">
    <div class="dev-header">YASU DEV_TOOLS v0.2 <span class="dev-close" onclick="toggleDevPanel()">[X]</span></div>
    
    <div class="dev-section">
        <h3>Performance</h3>
        <div style="font-size:11px; color:#aaa;">Memory: <span id="dev-mem">...</span></div>
        <div style="font-size:11px; color:#aaa;">Uptime: <span id="dev-uptime">0s</span></div>
        <button class="dev-btn" onclick="devToggleBlur()">TOGGLE GLASS BLUR</button>
    </div>

    <div class="dev-section">
        <h3>UI Manipulator</h3>
        <textarea id="dev-css-input" class="dev-textarea" placeholder="* { background: red !important; }"></textarea>
        <button class="dev-btn" onclick="devInjectCSS()">INJECT CSS</button>
    </div>

    <div class="dev-section">
        <h3>System Override</h3>
        <button class="dev-btn" onclick="devForceUnlock()">FORCE UNLOCK OS</button>
        <button class="dev-btn danger" onclick="devBSOD()">TRIGGER BSOD</button>
        <button class="dev-btn danger" onclick="devNuke()">NUKE STORAGE (WIPE)</button>
    </div>

    <div class="dev-section">
        <h3>Stress Test</h3>
        <button class="dev-btn" onclick="devWindowSpam()">WINDOW SPAMMER (x10)</button>
        <button class="dev-btn" onclick="devInstallAll()">INSTALL ALL APPS</button>
    </div>

    <div class="dev-section">
        <h3>Process Manager</h3>
        <div id="process-list" style="max-height: 100px; overflow-y: auto;"></div>
        <button class="dev-btn" onclick="devRefreshProcesses()">REFRESH LIST</button>
    </div>

    <div class="dev-section">
        <h3>Sentinel Debug</h3>
        <input type="text" id="dev-audio-url" class="dev-input" placeholder="MP3 URL">
        <button class="dev-btn" onclick="devForceAudio()">FORCE PLAY AUDIO</button>
    </div>

    <div class="dev-section">
        <h3>System Log</h3>
        <div class="dev-log" id="dev-log"></div>
    </div>
  </div>

  <div id="auth-layer">
    <div id="setup-screen" class="auth-container">
      <h2>Welcome to Yasu OS</h2><p style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 10px;">Create your account</p>
      <div class="input-wrapper"><input type="text" id="setup-username" class="auth-input" placeholder="Username"></div>
      <div class="input-wrapper"><input type="password" id="setup-password" class="auth-input" placeholder="Create Password"><i class="fas fa-eye toggle-password" onclick="toggleAuthPassword('setup-password')"></i></div>
      <div class="input-wrapper"><input type="password" id="setup-confirm" class="auth-input" placeholder="Confirm Password"><i class="fas fa-eye toggle-password" onclick="toggleAuthPassword('setup-confirm')"></i></div>
      <div class="input-wrapper"><input type="text" id="setup-pfp" class="auth-input" placeholder="Profile Pic URL (Optional)"></div>
      <button class="auth-btn" onclick="completeSetup()">Finish Setup</button>
    </div>
    <div id="lock-screen" class="auth-container">
        <img src="" id="lock-avatar" class="auth-avatar" alt="User">
        <h2 id="lock-username">User</h2>
        <div class="input-wrapper"><input type="password" id="lock-password" class="auth-input" placeholder="Enter Password"><i class="fas fa-eye toggle-password" onclick="toggleAuthPassword('lock-password')"></i></div>
        <button class="auth-btn" onclick="unlockSystem()">Unlock</button>
    </div>
  </div>

  <div id="os-interface">
      <div class="desktop"></div>
      <div class="taskbar">
        <div class="taskbar-start"><img src="https://img.icons8.com/fluency/96/windows-11.png" class="start-btn" alt="Start" onclick="alert('Start Menu feature coming soon!')" /></div>
        <div class="taskbar-apps"></div>
        <div class="taskbar-tray">
            <div class="tray-icons"><i class="fas fa-wifi"></i><i class="fas fa-volume-up"></i><i class="fas fa-battery-three-quarters"></i></div>
            <div class="tray-clock"><div id="taskbar-time">00:00</div><div id="taskbar-date">Date</div></div>
        </div>
      </div>
      <div id="custom-context-menu"><div id="delete-option"><i class="fas fa-trash"></i> Uninstall App</div></div>
      
      <div id="sentinel">
        <div class="header"><div class="time" id="clock-time">00:00</div><div class="date" id="clock-date">...</div></div>
        <div class="stage">
            <canvas id="viz-canvas"></canvas>
            <div class="controls-layer">
                <div class="track-info"><div class="t-title" id="track-title">System Ready</div><div class="t-artist" id="track-artist">2025 Mix</div></div>
                <div class="btn-row"><i class="fas fa-step-backward icon-btn" onclick="changeTrack(-1)"></i><div class="play-circle" onclick="togglePlay()"><i class="fas fa-play" id="play-icon"></i></div><i class="fas fa-step-forward icon-btn" onclick="changeTrack(1)"></i></div>
                <div class="playlist-box" id="playlist-list"></div>
            </div>
        </div>
        <div style="opacity: 0.5; font-size: 0.8rem; z-index: 2; margin-top: auto; padding-bottom: 10px; color: var(--accent);"><i class="fas fa-wave-square"></i></div>
      </div>
  </div>

  <audio id="audio-player" crossorigin="anonymous"></audio>

  <script>
    /* DEV PANEL LOGIC */
    function toggleDevPanel() {
        const panel = document.getElementById('dev-panel');
        panel.classList.toggle('active');
        if(panel.classList.contains('active')) {
            devLog('Dev Panel Opened');
            updateDevStats();
            devRefreshProcesses();
        }
    }

    function devLog(msg) {
        const log = document.getElementById('dev-log');
        const time = new Date().toLocaleTimeString();
        log.innerHTML += `<div>[${time}] ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function devForceUnlock() { revealOS(); devLog('Action: OS Force Unlocked'); }
    
    function devNuke() {
        if(confirm("DEV WARNING: WIPE EVERYTHING?")) { localStorage.clear(); location.reload(); }
    }
    
    function devInstallAll() {
        appList.forEach(app => app.installed = true);
        saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons();
        devLog('Action: All Apps Installed');
    }
    
    function devInjectCSS() {
        const css = document.getElementById('dev-css-input').value;
        const style = document.createElement('style');
        style.innerHTML = css;
        document.head.appendChild(style);
        devLog('Action: CSS Injected');
    }
    
    function devToggleBlur() {
        const root = document.documentElement;
        const current = getComputedStyle(root).getPropertyValue('--glass-surface');
        if(current.includes('0.05')) {
            root.style.setProperty('--glass-surface', 'rgba(10,10,10,0.9)');
            document.body.style.backdropFilter = "none"; // Not directly applicable to body but helps context
            devLog('Mode: Performance (Blur OFF)');
        } else {
            root.style.setProperty('--glass-surface', 'rgba(255, 255, 255, 0.05)');
            devLog('Mode: Aesthetics (Blur ON)');
        }
    }

    function devBSOD() {
        document.getElementById('bsod-layer').style.display = 'flex';
        devLog('CRITICAL: BSOD Triggered');
    }
    
    function devWindowSpam() {
        for(let i=0; i<10; i++) {
            setTimeout(() => {
                openApp('calculator'); // Spam calculators
                devLog('Spam: Window Created');
            }, i * 100);
        }
    }
    
    function devRefreshProcesses() {
        const list = document.getElementById('process-list');
        list.innerHTML = '';
        const windows = document.querySelectorAll('.window');
        windows.forEach(win => {
            if(win.style.display !== 'none') {
                const item = document.createElement('div');
                item.className = 'process-item';
                item.innerHTML = `<span>${win.id}</span> <span class="kill-btn" onclick="document.getElementById('${win.id}').style.display='none'; devRefreshProcesses()">KILL</span>`;
                list.appendChild(item);
            }
        });
    }

    function devForceAudio() {
        const url = document.getElementById('dev-audio-url').value;
        if(url) {
            audio.src = url;
            togglePlay();
            devLog('Audio: Forced Play ' + url);
        }
    }

    function updateDevStats() {
        if(!document.getElementById('dev-panel').classList.contains('active')) return;
        document.getElementById('dev-mem').innerText = Math.round(performance.memory ? performance.memory.usedJSHeapSize / 1024 / 1024 : 0) + " MB";
        document.getElementById('dev-uptime').innerText = Math.round(performance.now() / 1000) + "s";
        setTimeout(updateDevStats, 1000);
    }
    
    /* MATRIX MODE */
    function startMatrix() {
        const c = document.getElementById("matrix-layer");
        c.style.display = 'block';
        const ctx = c.getContext("2d");
        c.width = window.innerWidth; c.height = window.innerHeight;
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%";
        const font_size = 14;
        const columns = c.width / font_size;
        const drops = [];
        for (let x = 0; x < columns; x++) drops[x] = 1;
        function draw() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
            ctx.fillRect(0, 0, c.width, c.height);
            ctx.fillStyle = "#0F0"; ctx.font = font_size + "px monospace";
            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * font_size, drops[i] * font_size);
                if (drops[i] * font_size > c.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(draw, 35);
        devLog('Mode: Matrix Enabled');
    }

    /* AUTH LOGIC */
    const DEFAULT_AVATAR = "https://img.icons8.com/fluency/96/user-male-circle.png";
    let currentUserData = null;
    function initAuth() {
        const savedUser = localStorage.getItem('yasu_user_profile');
        const setupScreen = document.getElementById('setup-screen');
        const lockScreen = document.getElementById('lock-screen');
        if (!savedUser) { setupScreen.style.display = 'flex'; lockScreen.style.display = 'none'; devLog('State: OOBE'); } 
        else {
            currentUserData = JSON.parse(savedUser);
            setupScreen.style.display = 'none'; lockScreen.style.display = 'flex';
            document.getElementById('lock-username').innerText = currentUserData.username;
            document.getElementById('lock-avatar').src = currentUserData.pfp || DEFAULT_AVATAR;
            devLog('State: Locked');
        }
    }
    function toggleAuthPassword(inputId) { const input = document.getElementById(inputId); input.type = (input.type === "password") ? "text" : "password"; }
    function completeSetup() {
        const name = document.getElementById('setup-username').value.trim();
        const pass = document.getElementById('setup-password').value.trim();
        const confirmPass = document.getElementById('setup-confirm').value.trim();
        const pfp = document.getElementById('setup-pfp').value.trim();
        if (!name || !pass) { alert("Username and Password are required."); return; }
        if (pass !== confirmPass) { alert("Passwords do not match!"); return; }
        const userData = { username: name, password: pass, pfp: pfp || DEFAULT_AVATAR, wallpaper: localStorage.getItem('wallpaper') };
        localStorage.setItem('yasu_user_profile', JSON.stringify(userData));
        currentUserData = userData; revealOS();
    }
    function unlockSystem() {
        const inputPass = document.getElementById('lock-password').value;
        if (inputPass === currentUserData.password) { revealOS(); devLog('Auth: Success'); }
        else { const passInput = document.getElementById('lock-password'); passInput.classList.add('shake'); passInput.value = ''; setTimeout(() => passInput.classList.remove('shake'), 300); devLog('Auth: Failed Attempt'); }
    }
    document.getElementById('lock-password').addEventListener('keypress', function (e) { if (e.key === 'Enter') unlockSystem(); });
    function revealOS() {
        const authLayer = document.getElementById('auth-layer'); const osInterface = document.getElementById('os-interface');
        authLayer.style.opacity = '0'; authLayer.style.transform = 'scale(1.1)';
        osInterface.style.opacity = '1'; osInterface.style.pointerEvents = 'all';
        setTimeout(() => { authLayer.style.display = 'none'; loadOSData(); }, 600);
    }
    function loadOSData() {
        if (currentUserData && currentUserData.wallpaper) document.body.style.backgroundImage = `url('${currentUserData.wallpaper}')`;
        loadInstalledApps(); renderDesktopIcons(); renderTaskbarIcons();
    }

    /* OS LOGIC */
    const appList = [
      { name: 'Browser', icon: 'https://img.icons8.com/color/96/000000/chrome.png', content: '', installed: true, preinstalled: true, description: 'Surf the web' },
      { name: 'Terminal', icon: 'https://img.icons8.com/fluency/96/console.png', content: '', installed: true, preinstalled: true, description: 'System CLI' },
      { name: 'Settings', icon: 'https://img.icons8.com/fluent/96/000000/settings.png', content: '', installed: true, preinstalled: true, description: 'System Settings' },
      { name: 'App Store', icon: 'https://img.icons8.com/fluent/96/000000/app-store.png', content: '', installed: true, preinstalled: true, description: 'Download new apps' },
      { name: 'Calculator', icon: 'https://img.icons8.com/fluent/96/000000/calculator.png', content: 'https://www.desmos.com/scientific', installed: true, preinstalled: false, description: 'Do math' },
      { name: 'Notepad', icon: 'https://img.icons8.com/fluent/96/000000/notepad.png', content: 'data:text/html,<html><body style="margin:0;"><textarea style="width:100%;height:100%;font-size:18px;border:none;padding:10px;box-sizing:border-box;font-family:sans-serif;" placeholder="Type here..."></textarea></body></html>', installed: true, preinstalled: false, description: 'Write notes' },
      { name: 'VS Code', icon: 'https://img.icons8.com/fluent/96/000000/visual-studio-code-2019.png', content: 'https://vscode.dev', installed: false, preinstalled: false, description: 'Code Editor' }
    ];
    function loadInstalledApps() { const saved = localStorage.getItem('installedApps'); if (saved) { const installedApps = JSON.parse(saved); appList.forEach(app => { if (installedApps.hasOwnProperty(app.name)) app.installed = installedApps[app.name]; }); } }
    function saveInstalledApps() { const installedApps = {}; appList.forEach(app => installedApps[app.name] = app.installed); localStorage.setItem('installedApps', JSON.stringify(installedApps)); }
    function renderDesktopIcons() {
      const desktop = document.querySelector('.desktop'); desktop.innerHTML = '';
      appList.filter(app => app.installed).forEach(app => {
        const iconDiv = document.createElement('div'); iconDiv.className = 'icon';
        iconDiv.ondblclick = () => openApp(app.name.toLowerCase());
        iconDiv.addEventListener('contextmenu', function(e) { e.preventDefault(); if (!app.preinstalled) showContextMenu(e.pageX, e.pageY, app); });
        const img = document.createElement('img'); img.src = app.icon; const label = document.createElement('div'); label.textContent = app.name;
        iconDiv.append(img, label); desktop.appendChild(iconDiv);
      });
    }
    function renderTaskbarIcons() {
      const taskbarApps = document.querySelector('.taskbar-apps'); taskbarApps.innerHTML = '';
      appList.filter(app => app.installed).forEach(app => {
        const img = document.createElement('img'); img.src = app.icon; img.title = app.name;
        img.ondblclick = () => openApp(app.name.toLowerCase());
        img.addEventListener('contextmenu', function(e) { e.preventDefault(); if (!app.preinstalled) showContextMenu(e.pageX, e.pageY, app); });
        taskbarApps.appendChild(img);
      });
    }
    function openApp(appId) {
      const app = appList.find(a => a.name.toLowerCase() === appId); if (!app) return;
      let appWindow = document.getElementById(appId);
      if (!appWindow) createAppWindow(app);
      else { appWindow.classList.remove('fadeOut'); appWindow.style.display = 'block'; if (app.name.toLowerCase() === 'app store') renderAppStoreList(); }
      devLog('App Launched: ' + appId);
    }

    function createAppWindow(app) {
      const windowDiv = document.createElement('div'); windowDiv.className = 'window'; windowDiv.id = app.name.toLowerCase(); windowDiv.style.display = 'block';
      if(app.name === 'Browser') windowDiv.classList.add('browser-window'); 

      const titleBar = document.createElement('div'); titleBar.className = 'title-bar';
      const controls = document.createElement('div'); controls.className = 'controls';
      const closeButton = document.createElement('button'); closeButton.onclick = () => { windowDiv.classList.add('fadeOut'); setTimeout(() => windowDiv.style.display = 'none', 300); };
      controls.append(closeButton, document.createElement('div'), document.createElement('div'));
      controls.children[1].className = 'fake-min'; controls.children[2].className = 'fake-max';
      const titleText = document.createElement('span'); titleText.textContent = app.name;
      titleBar.append(controls, titleText, document.createElement('div'));

      const contentDiv = document.createElement('div'); contentDiv.className = 'content';

      if (app.name.toLowerCase() === 'browser') {
        contentDiv.innerHTML = `<div class="browser-bar"><button class="browser-btn" id="b-back"><i class="fas fa-arrow-left"></i></button><button class="browser-btn" id="b-refresh"><i class="fas fa-redo"></i></button><button class="browser-btn" id="b-home"><i class="fas fa-home"></i></button><input type="text" class="browser-input" id="b-url" placeholder="Search Google or type a URL"><button class="browser-btn" id="b-go"><i class="fas fa-arrow-right"></i></button></div><iframe class="browser-frame" id="b-frame" src="https://www.google.com/webhp?igu=1"></iframe>`;
        setTimeout(() => setupBrowserLogic(contentDiv), 0);
      } else if (app.name.toLowerCase() === 'terminal') {
          contentDiv.classList.add('terminal-window');
          contentDiv.innerHTML = `<div class="terminal-output" id="term-output">YasuOS Terminal [v1.0.0]<br>Type 'help' for commands.<br><br></div><div class="terminal-input-line"><span class="terminal-prompt">root@yasu:~#</span><input type="text" class="terminal-input" id="term-input" autofocus></div>`;
          setTimeout(() => setupTerminalLogic(contentDiv), 0);
      } else if (app.name.toLowerCase() === 'settings') {
        const settingsHTML = document.createElement('div'); settingsHTML.style.padding = "20px"; settingsHTML.style.color = "#333";
        settingsHTML.innerHTML = `<h3>Appearance</h3><p>Change Wallpaper</p><input type="text" id="bg-url" placeholder="Image URL"><button onclick="changeBackground()">Apply</button><hr><h3>Account</h3><p>Logged in as: <strong id="settings-user">${currentUserData ? currentUserData.username : 'User'}</strong></p><button onclick="localStorage.removeItem('yasu_user_profile'); location.reload();" style="background:red; color:white;">Reset Account (Logout)</button>`;
        contentDiv.appendChild(settingsHTML);
      } else if (app.name.toLowerCase() === 'app store') {
        const appStoreDiv = document.createElement('div'); appStoreDiv.style.padding = "20px"; appStoreDiv.style.backgroundColor = "#f5f5f5"; appStoreDiv.style.height = "100%"; appStoreDiv.style.overflowY = "auto";
        appStoreDiv.innerHTML = `<h3 style="color:black;">App Store</h3><div id="app-store-list"></div>`;
        contentDiv.appendChild(appStoreDiv); setTimeout(renderAppStoreList, 0);
      } else {
        const iframe = document.createElement('iframe'); iframe.src = app.content; contentDiv.appendChild(iframe);
      }
      const resizeHandle = document.createElement('div'); resizeHandle.className = 'resize-handle';
      windowDiv.append(titleBar, contentDiv, resizeHandle); document.body.appendChild(windowDiv);
      makeDraggableAndResizable(windowDiv); return windowDiv;
    }

    function setupBrowserLogic(container) {
        const frame = container.querySelector('#b-frame'); const input = container.querySelector('#b-url'); const btnGo = container.querySelector('#b-go'); const btnBack = container.querySelector('#b-back'); const btnRef = container.querySelector('#b-refresh'); const btnHome = container.querySelector('#b-home');
        const homeURL = "https://www.google.com/webhp?igu=1";
        function navigate() {
            let val = input.value.trim(); if(!val) return;
            if (val.includes('youtube.com/watch?v=')) val = val.replace('watch?v=', 'embed/'); else if (val.includes('youtu.be/')) val = val.replace('youtu.be/', 'youtube.com/embed/'); 
            else if (val.includes('.') && !val.includes(' ')) { if (!val.startsWith('http')) val = 'https://' + val; } else val = `https://www.google.com/search?q=${encodeURIComponent(val)}&igu=1`;
            frame.src = val; input.value = val;
        }
        btnGo.onclick = navigate; input.addEventListener('keydown', e => { if(e.key === 'Enter') navigate(); }); btnRef.onclick = () => frame.contentWindow.location.reload(); btnHome.onclick = () => { frame.src = homeURL; input.value = ""; }; btnBack.onclick = () => history.back();
    }

    function setupTerminalLogic(container) {
        const input = container.querySelector('#term-input'); const output = container.querySelector('#term-output');
        container.addEventListener('click', () => input.focus());
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const cmd = input.value.trim(); output.innerHTML += `<span style="color:#ccc;">root@yasu:~# ${cmd}</span><br>`;
                processCommand(cmd, output); input.value = ''; output.scrollTop = output.scrollHeight;
            }
        });
    }
    function processCommand(cmd, output) {
        const args = cmd.split(' '); const main = args[0].toLowerCase();
        switch(main) {
            case 'dev': toggleDevPanel(); output.innerHTML += "Dev Panel Toggled.<br>"; break;
            case 'help': output.innerHTML += `Available commands:<br> &nbsp; dev, matrix, bsod, help, clear, reset, reboot, whoami, ls, install, uninstall, setbg<br>`; break;
            case 'clear': output.innerHTML = ''; break;
            case 'reset': if(confirm("WARNING: This will wipe all accounts, wallpapers, and data. Continue?")) { localStorage.clear(); location.reload(); } else { output.innerHTML += "Reset cancelled.<br>"; } break;
            case 'reboot': location.reload(); break;
            case 'bsod': devBSOD(); break;
            case 'matrix': startMatrix(); output.innerHTML += "Wake up, Neo...<br>"; break;
            case 'whoami': output.innerHTML += `${currentUserData ? currentUserData.username : 'unknown'}<br>`; break;
            case 'ls': appList.forEach(app => { output.innerHTML += `${app.installed ? '[INSTALLED]' : '[-------]'} ${app.name}<br>`; }); break;
            case 'setbg': if(args[1]) { document.body.style.backgroundImage = `url('${args[1]}')`; if(currentUserData) { currentUserData.wallpaper = args[1]; localStorage.setItem('yasu_user_profile', JSON.stringify(currentUserData)); } output.innerHTML += "Wallpaper updated.<br>"; } else output.innerHTML += "Error: Missing URL.<br>"; break;
            case 'install': if(args[1]) { let target = appList.find(a => a.name.toLowerCase() === args[1].toLowerCase()); if(target) { target.installed = true; saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons(); output.innerHTML += `App '${target.name}' installed.<br>`; } else output.innerHTML += `App '${args[1]}' not found in database.<br>`; } else output.innerHTML += "Usage: install [appname]<br>"; break;
            case 'uninstall': if(args[1]) { let target = appList.find(a => a.name.toLowerCase() === args[1].toLowerCase()); if(target) { if(target.preinstalled && args[1].toLowerCase() !== 'terminal') output.innerHTML += "Cannot uninstall core system apps.<br>"; else { target.installed = false; saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons(); output.innerHTML += `App '${target.name}' uninstalled.<br>`; } } else output.innerHTML += `App '${args[1]}' not found.<br>`; } else output.innerHTML += "Usage: uninstall [appname]<br>"; break;
            case '': break;
            default: output.innerHTML += `Command not found: ${main}<br>`;
        }
    }

    /* COMMON UI */
    function makeDraggableAndResizable(win) {
      let bar = win.querySelector('.title-bar'); let resizeHandle = win.querySelector('.resize-handle');
      let isDragging = false, isResizing = false; let startX, startY, startWidth, startHeight, offsetX, offsetY;
      bar.addEventListener('mousedown', e => { if(e.target.tagName === 'BUTTON' || e.target.className.includes('fake') || e.target.className.includes('browser')) return; isDragging = true; offsetX = e.clientX - win.offsetLeft; offsetY = e.clientY - win.offsetTop; });
      resizeHandle.addEventListener('mousedown', e => { isResizing = true; startX = e.clientX; startY = e.clientY; startWidth = win.offsetWidth; startHeight = win.offsetHeight; e.stopPropagation(); });
      document.addEventListener('mousemove', function(e) { if (isDragging) { win.style.left = (e.clientX - offsetX) + 'px'; win.style.top = (e.clientY - offsetY) + 'px'; } if (isResizing) { win.style.width = startWidth + (e.clientX - startX) + 'px'; win.style.height = startHeight + (e.clientY - startY) + 'px'; } });
      document.addEventListener('mouseup', function() { isDragging = false; isResizing = false; });
    }
    function changeBackground() { const bgInput = document.getElementById('bg-url'); if (bgInput && bgInput.value) { document.body.style.backgroundImage = `url('${bgInput.value}')`; if(currentUserData) { currentUserData.wallpaper = bgInput.value; localStorage.setItem('yasu_user_profile', JSON.stringify(currentUserData)); } } }
    function renderAppStoreList() {
      const storeList = document.getElementById('app-store-list'); if (!storeList) return; storeList.innerHTML = '';
      const uninstalledApps = appList.filter(app => !app.installed && app.name.toLowerCase() !== 'app store');
      if (uninstalledApps.length === 0) { storeList.innerHTML = '<p style="color:black;">All apps are installed.</p>'; return; }
      uninstalledApps.forEach(app => {
        const appDiv = document.createElement('div'); appDiv.style.border = '1px solid #ccc'; appDiv.style.padding = '10px'; appDiv.style.marginBottom = '10px'; appDiv.style.borderRadius = '5px'; appDiv.style.backgroundColor = 'white'; appDiv.style.color = '#333';
        appDiv.innerHTML = `<div style="display:flex; align-items:center;"><img src="${app.icon}" style="width:40px; height:40px; margin-right:10px;"><span style="font-weight:bold;">${app.name}</span></div><div style="font-size:12px; color:#666; margin-top:5px;">${app.description}</div>`;
        const installButton = document.createElement('button'); installButton.textContent = 'Install'; installButton.style.marginTop = '10px'; installButton.style.padding = '5px 15px';
        installButton.onclick = () => { app.installed = true; saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons(); renderAppStoreList(); };
        appDiv.appendChild(installButton); storeList.appendChild(appDiv);
      });
    }
    let currentContextApp = null;
    function showContextMenu(x, y, app) { currentContextApp = app; const menu = document.getElementById('custom-context-menu'); menu.style.left = x + 'px'; menu.style.top = y + 'px'; menu.style.display = 'block'; }
    function hideContextMenu() { document.getElementById('custom-context-menu').style.display = 'none'; currentContextApp = null; }
    document.getElementById('delete-option').addEventListener('click', function() { if (currentContextApp && !currentContextApp.preinstalled) { currentContextApp.installed = false; saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons(); renderAppStoreList(); } hideContextMenu(); });
    document.getElementById('custom-context-menu').addEventListener('click', e => e.stopPropagation()); document.addEventListener('click', hideContextMenu);
    function updateTaskbarClock() { const now = new Date(); document.getElementById('taskbar-time').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false}); document.getElementById('taskbar-date').innerText = now.toLocaleDateString([], {month:'short', day:'numeric', year:'numeric'}); }
    setInterval(updateTaskbarClock, 1000);

    /* SENTINEL */
    const trackList = [ { title: "VIGILANTE", artist: "Praz Khanal", file: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=phonk-music-112624.mp3" }, { title: "MIDNIGHT TOKYO", artist: "Audiogreen", file: "https://cdn.pixabay.com/download/audio/2022/06/27/audio_50827a6806.mp3?filename=phonk-115883.mp3" }, { title: "GRAVE RAVE", artist: "QubeSounds", file: "https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3?filename=trap-action-energetic-127421.mp3" }, { title: "DOOM SLAYER", artist: "AlexiAction", file: "https://cdn.pixabay.com/download/audio/2023/08/03/audio_4a681647c4.mp3?filename=scary-phonk-161340.mp3" }, { title: "HYPER DRIFT", artist: "RoyaltyFree", file: "https://cdn.pixabay.com/download/audio/2023/04/21/audio_1125d33697.mp3?filename=drift-phonk-147222.mp3" } ];
    function updateSentinelClock() { const now = new Date(); document.getElementById('clock-time').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false}); document.getElementById('clock-date').innerText = now.toLocaleDateString([], {weekday:'long', day:'numeric'}); }
    setInterval(updateSentinelClock, 1000); updateSentinelClock();
    const audio = document.getElementById('audio-player'); const playIcon = document.getElementById('play-icon'); const playlistEl = document.getElementById('playlist-list'); const canvas = document.getElementById('viz-canvas'); const ctx = canvas.getContext('2d'); let audioCtx, analyser, source; let isPlaying = false; let currentIdx = 0;
    function renderPlaylist() { playlistEl.innerHTML = ''; trackList.forEach((track, index) => { const div = document.createElement('div'); div.className = `pl-item ${index === currentIdx ? 'active' : ''}`; div.onclick = () => loadTrack(index); div.innerHTML = `<span class="pl-title">${track.title}</span><div class="pl-anim"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>`; playlistEl.appendChild(div); }); }
    function loadTrack(index) { if (index < 0) index = trackList.length - 1; if (index >= trackList.length) index = 0; currentIdx = index; const track = trackList[currentIdx]; audio.src = track.file; document.getElementById('track-title').innerText = track.title; document.getElementById('track-artist').innerText = track.artist; renderPlaylist(); if(isPlaying) { playIcon.className = 'fas fa-circle-notch fa-spin'; audio.play().then(() => playIcon.className = 'fas fa-pause'); } }
    function setupAudioContext() { if(audioCtx) return; audioCtx = new (window.AudioContext || window.webkitAudioContext)(); analyser = audioCtx.createAnalyser(); source = audioCtx.createMediaElementSource(audio); source.connect(analyser); analyser.connect(audioCtx.destination); analyser.fftSize = 128; }
    function togglePlay() { if (!audio.src) loadTrack(0); if (!audioCtx) setupAudioContext(); if (audio.paused) { audio.play(); isPlaying = true; playIcon.className = 'fas fa-pause'; loop(); } else { audio.pause(); isPlaying = false; playIcon.className = 'fas fa-play'; } }
    function changeTrack(direction) { loadTrack(currentIdx + direction); if(!isPlaying) togglePlay(); }
    audio.addEventListener('ended', () => changeTrack(1));
    function loop() { if(!isPlaying) return; requestAnimationFrame(loop); canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; const w = canvas.width; const h = canvas.height; const bufferLength = analyser.frequencyBinCount; const dataArray = new Uint8Array(bufferLength); analyser.getByteFrequencyData(dataArray); ctx.clearRect(0, 0, w, h); const barWidth = (w / bufferLength) * 1.5; let x = 0; for(let i = 0; i < bufferLength; i++) { let val = dataArray[i]; if (i < 8) val *= 1.2; const barHeight = (val / 255) * (h * 0.75); const gradient = ctx.createLinearGradient(0, h/2 - barHeight/2, 0, h/2 + barHeight/2); gradient.addColorStop(0, 'rgba(157, 78, 221, 0.8)'); gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.9)'); gradient.addColorStop(1, 'rgba(157, 78, 221, 0.8)'); ctx.fillStyle = gradient; ctx.beginPath(); const y = (h - barHeight) / 2; ctx.roundRect(x, y, barWidth - 2, barHeight, 4); ctx.fill(); x += barWidth; } }
    renderPlaylist(); document.getElementById('track-title').innerText = trackList[0].title; document.getElementById('track-artist').innerText = trackList[0].artist;
    window.onload = function() { initAuth(); updateTaskbarClock(); };
  </script>
</body>
</html>
